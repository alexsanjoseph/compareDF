<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Do a Git Style Diff of the Rows Between Two Dataframes with Similar Structure • compareDF</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Do a Git Style Diff of the Rows Between Two Dataframes with Similar Structure">
<meta property="og:description" content="Compares two dataframes which have the same column
    structure to show the rows that have changed. Also gives a git style diff format
    to quickly see what has changed in addition to summary statistics.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">compareDF</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="comparedf" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#comparedf" class="anchor"></a>compareDF</h1></div>
<p><strong>New Version released with XLSX Support!!</strong></p>
<p><a href="https://codecov.io/github/alexsanjoseph/compareDF?branch=master"><img src="https://codecov.io/github/alexsanjoseph/compareDF/coverage.svg?branch=master" alt="codecov.io"></a> <a href="https://travis-ci.org/alexsanjoseph/compareDF"><img src="https://travis-ci.org/alexsanjoseph/compareDF.svg?branch=master" alt="Travis-CI Build Status"></a> <a href="https://ci.appveyor.com/project/alexsanjoseph/compareDF"><img src="https://ci.appveyor.com/api/projects/status/github/alexsanjoseph/compareDF?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a> <a href="https://github.com/alexsanjoseph/compareDF/actions?query=workflow%3AR-CMD-check"><img src="https://github.com/alexsanjoseph/compareDF/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a> <a href="https://github.com/alexsanjoseph/compareDF/actions?query=workflow%3ADocker"><img src="https://github.com/alexsanjoseph/compareDF/workflows/Docker/badge.svg" alt="Docker"></a></p>
<p><a href="https://cran.r-project.org/package=compareDF"><img src="https://www.r-pkg.org/badges/version/compareDF" alt="CRAN_Status_Badge"></a> <a href="https://www.r-pkg.org/pkg/compareDF"><img src="https://cranlogs.r-pkg.org/badges/compareDF" alt="CRAN RStudio mirror downloads"></a> <img src="https://cranlogs.r-pkg.org/badges/grand-total/compareDF" alt="CRAN Total Downloads"><img src="https://img.shields.io/badge/license-MIT%20License-blue.svg" alt="License"></p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Every so often while doing data analysis, I have come across a situation where I have two datasets, which have the same structure but with small differences in the actual data between the two. For example:</p>
<ul>
<li>Variation of a dataset across different time periods for the same grouping</li>
<li>Variation of values for different algorithms, etc.</li>
</ul>
<p>In the above cases, I want to easily identify what has changed across the two data.frames, how much has changed, and also hopefully to get a quick summary of the extent of change. There are packages like the <code>compare</code> package on R, which have focused more on the structure of the data frame and lesser on the data itself. I was not able to easily identify and isolate what has changed in the data itself. So I decided to write one for myself. That is what <code>compareDF</code> package is all about.</p>
<p>The output can be visualized either on the RStudio Viewer, or sent to a file as an <code>HTML</code> or an <code>XLSX</code> file.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the CRAN version of the package as below:</p>
<pre class="{r}"><code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("compareDF")</a></code></pre>
<p>Development version can be installed using <code>devtools</code></p>
<pre class="{r}"><code>devtools::install_github('alexsanjoseph/compareDF')</code></pre>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>The package has a single function, <code>compare_df</code>. It takes in two data frames, and one or more grouping variables and does a comparison between the the two. In addition you can specify columns to ignore, decide how many rows of changes to be displayed in the case of the HTML output, and decide what tolerance you want to provide to detect change.</p>
</div>
<div id="basic-example" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-example" class="anchor"></a>Basic Example</h2>
<p>Let’s take the example of a teacher who wants to compare the marks and grades of students across two years, 2010 and 2011. The data is stored in tabular format.</p>
<pre class="{r}"><code><a href="https://rdrr.io/r/base/library.html">library(compareDF)
data("results_2010", "results_2011")
print(results_2010)
print(results_2011)</a></code></pre>
<p>The data shows the performance of students in two divisions, A and B for two years. Some subjects like <em>Maths, Physics, Chemistry and Art</em> are given scores while others like <em>Discipline and PE</em> are given grades.</p>
<p>It is possible that there are students of the same name in two divisions, for example, there is a <em>Rohit</em> in both the divisions in 2011.</p>
<p>It is also possible that some students have dropped out, or added new across the two years. Eg: - <em>Mugger and Dhakkan</em> dropped out while <em>Vikram and Dikchik</em> where added in the Division B</p>
<p>The package allows a user to quickly identify these changes.</p>
<div id="basic-comparison" class="section level3">
<h3 class="hasAnchor">
<a href="#basic-comparison" class="anchor"></a>Basic Comparison</h3>
<p>Now let’s compare the performance of the students across the years. The grouping variables are the <em>Student</em> column. We will ignore the <em>Division</em> column and assume that the student names are unique across divisions. In this sub-example, if a student appears in two divisions, he/she has studied in both of them.</p>
<pre class="{r}"><code>ctable_student = compare_df(results_2011, results_2010, c("Student"))
ctable_student$comparison_df
</code></pre>
<p>By default, no columns are excluded from the comparison, so any of the tuple of grouping variables which are different across the two data frames are shown in the comparison table. The <code>comparison_df</code> table shows all the rows for which at least one record has changed. Conversely, if nothing has changed across the two tables, the rows are not displayed. If a new record has been introduced or a record has been removed, those are displayed as well.</p>
<p>For example, <em>Akshay, Division A</em> has had the exact same scores but has two different grades for <em>Discipline</em> across the two years so that row is included.</p>
<p>However, <em>Macho, Division B</em> has had the exact same scores in both the years for all subjects, so his data is not shown in the comparison table.</p>
</div>
<div id="html-output" class="section level3">
<h3 class="hasAnchor">
<a href="#html-output" class="anchor"></a>HTML Output</h3>
<p>While the comparison table can be quickly summarized in various forms for futher analysis, it is very difficult to process visually. The <code>html_output</code> provides a way to represent this is a way that is easier for the numan eye to read. NOTE: You need to install the <code>htmlTable</code> package for the HTML comparison to work.</p>
<p><code>{r, results = 'hide'} create_output_table(ctable_student)</code> <img src="https://raw.githubusercontent.com/alexsanjoseph/compareDF/master/man/figures/pic_1.png" width="500"></p>
<p>Now it is very easy to see recognize what has changed. A single cell is colored if it has changed across the two datasets. The value of the cell in the older dataset is colored red and the value of the cell in the newer dataset is colored green. Cells that haven’t changed across the two datasets are colored grey.</p>
<p>If a new row was introduced, the Row group names (and all the other columns for that row as well ) are colored in Green. Similarly, a row group name (and the other columns in that row) are colored red if a row was removed.</p>
<p>For Example, <em>Akshay</em>, <em>Ananth</em> and <em>Bulla</em> has had changes in scores, which are in <em>Discipline</em>, <em>Maths</em>, and <em>Maths</em> respectively. <em>Dhakkan</em> and <em>Mugger</em> have dropped out of the dataset from 2010 and the all the columns for the rows are shown in red, which <em>DikChik</em> and <em>Vikram</em> have joined new in the data set and all the columns for the rows are in green.</p>
</div>
<div id="xlsx-output" class="section level3">
<h3 class="hasAnchor">
<a href="#xlsx-output" class="anchor"></a>XLSX Output</h3>
<p>Alternately you can write to an xlsx file as well</p>
<pre class="{r}"><code><a href="reference/create_output_table.html">create_output_table(ctable_student, output_type = 'xlsx', file_name = "test_file.xlsx")</a></code></pre>
<p><img src="https://raw.githubusercontent.com/alexsanjoseph/compareDF/master/man/figures/compareDF_excel_output.png" width="500"></p>
</div>
<div id="change-count-and-summary" class="section level3">
<h3 class="hasAnchor">
<a href="#change-count-and-summary" class="anchor"></a>Change Count and Summary</h3>
<p>You can get an details of what has changed for each group using the <code>change_count</code> object in the output. A summary of the same is provided in the <code>change_summary</code> object.</p>
<pre class="{r}"><code>ctable_student$change_count</code></pre>
<pre class="{r}"><code>ctable_student$change_summary</code></pre>
</div>
<div id="grouping-multiple-columns" class="section level3">
<h3 class="hasAnchor">
<a href="#grouping-multiple-columns" class="anchor"></a>Grouping Multiple Columns</h3>
<p>We can also group_multiple columns into the grouping variable</p>
<p><code>{r, results = 'hide'} ctable_student_div = compare_df(results_2011, results_2010, c("Division", "Student")) ctable_student_div$comparison_df</code> <img src="https://raw.githubusercontent.com/alexsanjoseph/compareDF/master/man/figures/pic_2.png" width="500"></p>
<p>Now <em>Rohits</em> in each individual division are considered as belonging to separate groups and compared accordingly. All the other summaries also change appropriately.</p>
</div>
<div id="excluding-certain-columns" class="section level3">
<h3 class="hasAnchor">
<a href="#excluding-certain-columns" class="anchor"></a>Excluding certain Columns</h3>
<p>You can ignore certain columns using the <em>exclude</em> parameter. The fields that have to be excluded can be given as a character vector. (This is a convenience function to deal with the case where some columns are not included)</p>
</div>
<div id="preserving-all-rows" class="section level3">
<h3 class="hasAnchor">
<a href="#preserving-all-rows" class="anchor"></a>Preserving all rows</h3>
<p>The default behavior of the <code>compare_df</code> function is to show only the records that have changed. Sometimes the use might want to preserve all the records even after the comparison and not just see the values that have been changed (especially in the HTML). In this case, you can set the <code>keep_unchanged</code> parameter to <code>TRUE</code>.</p>
</div>
<div id="limiting-html-size" class="section level3">
<h3 class="hasAnchor">
<a href="#limiting-html-size" class="anchor"></a>Limiting HTML size</h3>
<p>For dataframes which have a large amount of differences in them, generating HTML might take a long time and crash your system. So the maximum diff size for the HTML (and for the HTML visualization only) is capped at 100 by default. If you want to see more difference, you can change the <code>limit_html</code> parameter appropriately. NOTE: This is only of the HTML output which is used for visual checking. The main comparison data frame and the summaries ALWAYS include data from all the rows.</p>
</div>
<div id="changing-color" class="section level3">
<h3 class="hasAnchor">
<a href="#changing-color" class="anchor"></a>Changing color</h3>
<p>You can use the <code>color_scheme</code> parameter to change the color of the cells generated. The parameter must me a named vector or a list with the appropriate names - The default values are <code><a href="https://rdrr.io/r/base/c.html">c("addition" = "green", "removal" = "red", "unchanged_cell" = "gray", "unchanged_row" = "deepskyblue")</a></code> but can be changed as needed by the user.</p>
</div>
<div id="tolerance" class="section level3">
<h3 class="hasAnchor">
<a href="#tolerance" class="anchor"></a>Tolerance</h3>
<p>It is possible that you’d like numbers very close to each other to be ignored. For example, if the marks of a student vary by less that 5% across the years, it could be due to random error and not any real performance indictaor. In such a case, you would want to give a tolerance parameter. For this case, giving a tolerance of <code>0.05</code> would ignore all the changes that are less than 5% apart from the lower value.</p>
<p><code>{r, results = 'hide'} ctable_student_div = compare_df(results_2011, results_2010, c("Division", "Student"), tolerance = 0.05) create_output_table(ctable_student_div)</code> <img src="https://raw.githubusercontent.com/alexsanjoseph/compareDF/master/man/figures/pic_3.png" width="500"></p>
<p><em>Venu from division A</em> who had a score change from 100 to 99 is no longer present in the diff calculation or in the output</p>
<p>Naturally, tolerance has no meaning for non-numeric values.</p>
</div>
</div>
<div id="additional-features" class="section level2">
<h2 class="hasAnchor">
<a href="#additional-features" class="anchor"></a>Additional features</h2>
<ul>
<li>set the color scheme in the output using the <code>color_scheme</code> argument</li>
<li>preserve the rows that have not changed in the analysis using the <code>keep_unchanged_rows</code> argument</li>
<li>use <code>difference</code> as an argument to use difference rather than ratio for tolerance</li>
<li>options to name the columns in the output</li>
<li>option change column name</li>
<li>option to change group column name</li>
<li>keep only the columns which have changed using <code>keep_unchanged_cols</code>
</li>
<li>convert output to wide format using <code>create_wide_output</code>
</li>
<li>customize nomenclature of the chng_type using <code>change_markers</code>
</li>
</ul>
</div>
<div id="using-compare-df-in-gap-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#using-compare-df-in-gap-analysis" class="anchor"></a>Using compare DF in GAP analysis</h2>
<p>The compareDF package can be used to conduct effective Gap analyses. If the package is used in this way, a configuration recommendation should be considered when using the compare_df function. Make sure the group column (group_col argument) being used as the gap classifier is unique and is not duplicated within either of the datasets being compared. Duplicate group names can skew gap analysis results. For example, using the results_2010 and results_2011 samples where Student represents the group_col argument, ‘Rohit’ group results are skewed. This is because student ‘Rohit’ is provided in the results_2011 sample twice. In this example Rohit represents two different students with the same last name. In short, if there are more than (2) records per grouping in a typical Gap analysis result, it suggests that there is a duplicate grouping contained within a single dataset that should be renamed and re-identified. If this occurs, changes should be made to the comparison datasets, and the Gap analysis should be re-conducted. The best way to prevent skewed results from occurring is to use all the columns that uniquely define a row in the group column argument - in this case, both name and student columns (alternatively a unique key identifier can also be constructed).</p>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p>Thanks to D3SL<a href="https://github.com/D3SL" class="uri">https://github.com/D3SL</a> for the reimplementation of the core engine using data.table which should increase the peformance by quite a bit.</p>
<p>Thanks to Nitin for proofreading the doc and making sure everything made sense.</p>
</div>
<div id="contributors" class="section level2">
<h2 class="hasAnchor">
<a href="#contributors" class="anchor"></a>Contributors</h2>
<ul>
<li>D3SL <a href="https://github.com/D3SL" class="uri">https://github.com/D3SL</a>
</li>
<li>Brice Richard</li>
<li>Joshua David Barillas - <a href="https://github.com/jdbarillas" class="uri">https://github.com/jdbarillas</a>
</li>
</ul>
<p>License (MIT)</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the ‘Software’), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED ‘AS IS’, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
<p><em>A version of this README has been published as a blog <a href="http://alexsanjoseph.github.io/r/2018/10/03/comparing-dataframes-in-r-using-comparedf">here</a></em></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=compareDF">https://​cloud.r-project.org/​package=compareDF</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Alex Joseph <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Alex Joseph.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
